# This test validates the plugin list command.
# Currently it works only for system-runtime plugins and we only have one
# system runtime plugin so testing is a bit limited.
#
# Note that commands that return errors will stop running a script, so we
# have new RUN lines for any command that is expected to return an error.

# RUN: %lldb -s %s -o exit 2>&1 | FileCheck %s

# Test plugin list without an argument will list all plugins.
plugin list
# CHECK-LABEL: plugin list
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin list with an argument will match a plugin name by substring.
plugin list macosx
# CHECK-LABEL: plugin list macosx
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin exact list works with fully qualified name.
plugin list -x system-runtime.systemruntime-macosx
# CHECK-LABEL: plugin list -x system-runtime.systemruntime-macosx
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin glob list works with fully qualified name.
plugin list system-runtime.systemruntime-macosx
# CHECK-LABEL: plugin list system-runtime.systemruntime-macosx
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin exact list still allows glob patterns.
plugin list -x system*
# CHECK-LABEL: plugin list -x system*
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin glob list still allows glob patterns.
plugin list system-runtime.*
# CHECK-LABEL: plugin list system-runtime.*
# CHECK: system-runtime
# CHECK:  [+] systemruntime-macosx           System runtime plugin for Mac OS X native libraries

# Test plugin list can disable implicit glob patterns.
# RUN: %lldb -o "plugin list -x macosx" 2>&1 | FileCheck %s --check-prefix=ERROR_PLUGIN_NOT_FOUND

# Test plugin list for unknown plugin returns an error.
# RUN: %lldb -o "plugin list some-plugin-that-does-not-exist" 2>&1 | FileCheck %s --check-prefix=ERROR_PLUGIN_NOT_FOUND
# ERROR_PLUGIN_NOT_FOUND: error: Found no matching plugins
